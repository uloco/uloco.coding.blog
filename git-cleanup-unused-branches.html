<!DOCTYPE html><html><head><title>uloco blog | Git Cleanup Unused Branches</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/blog/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons%7CMaterial+Icons+Outlined&amp;display=swap" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/blog/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/blog/bundle/codedoc-bundle.js"></script><script>window.githubConfig={"repo":"uloco.coding.blog","user":"uloco"}</script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="uloco blog | Git Cleanup Unused Branches"><meta property="og:type" content="article"><meta property="og:title" content="uloco blog | Git Cleanup Unused Branches"><meta property="og:image" content="https://images.unsplash.com/photo-1556075798-4825dfaaf498?w=1900&amp;h=600&amp;fit=crop"><meta name="keywords" content=""><meta property="blog-tags" content=""></head><body><div class="header-0-0-4"><a class="watermark-0-0-3" href="https://coding.blog" target="_blank"><svg viewBox="0 0 701 443" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="coding.blog" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-162.000000, -246.000000)" id="Shape"><path d="M538.081948,246.348452 L538.52402,246.445719 L538.52402,246.445719 L538.85529,246.526578 L538.85529,246.526578 L600.956012,263.165455 C602.767076,263.660918 604.526214,264.465865 606.146589,265.591976 C611.80881,269.527048 614.090389,276.211909 612.345003,282.123825 L538.2641,559.728905 C537.816127,561.562539 536.989561,563.335054 535.765607,564.944016 C530.70443,571.597248 520.764856,572.934442 513.564947,567.930724 C507.902727,563.995652 505.621148,557.310791 507.366534,551.398875 L577.145082,289.91439 L546.233523,281.631663 L462.305576,595.917544 L468.439004,634.645619 L493.907962,603.194573 C499.468987,596.327279 509.54413,595.268339 516.411424,600.829364 C523.278717,606.390389 524.337658,616.465532 518.776633,623.332826 L470.948283,682.395919 C466.887248,687.410879 460.418878,689.3283 454.55045,687.832105 L454.212574,687.741996 C448.224449,686.200133 443.421088,681.240355 442.392221,674.744345 L430.503202,599.680031 C430.418831,599.147339 430.361793,598.616628 430.331048,598.089327 C429.783912,595.705405 429.838457,593.220092 430.535776,590.858154 L519.361965,258.223717 L519.447729,257.889555 L519.447729,257.889555 L519.532157,257.586199 L519.627058,257.23399 C520.074771,255.398716 520.901697,253.624577 522.126677,252.014264 C525.828762,247.147643 532.141006,245.125338 538.081948,246.348452 Z M632.156421,656.157784 C640.992977,656.157784 648.156421,663.321228 648.156421,672.157784 C648.156421,680.99434 640.992977,688.157784 632.156421,688.157784 L528.156421,688.157784 C519.319865,688.157784 512.156421,680.99434 512.156421,672.157784 C512.156421,663.321228 519.319865,656.157784 528.156421,656.157784 L632.156421,656.157784 Z M699.234631,342.452157 L857.62655,500.844076 C863.874939,507.092464 863.874939,517.223104 857.62655,523.471493 L699.234631,681.863412 C692.986243,688.1118 682.855603,688.1118 676.607214,681.863412 C670.358826,675.615023 670.358826,665.484383 676.607214,659.235995 L823.686132,512.157077 L676.607214,365.079574 C670.358826,358.831185 670.358826,348.700545 676.607214,342.452157 C682.855603,336.203768 692.986243,336.203768 699.234631,342.452157 Z M347.705627,342.452157 C353.954016,348.700545 353.954016,358.831185 347.705627,365.079574 L200.62671,512.158491 L347.705627,659.235995 C353.954016,665.484383 353.954016,675.615023 347.705627,681.863412 C341.457239,688.1118 331.326599,688.1118 325.07821,681.863412 L166.686292,523.471493 C160.437903,517.223104 160.437903,507.092464 166.686292,500.844076 L325.07821,342.452157 C331.326599,336.203768 341.457239,336.203768 347.705627,342.452157 Z"></path></g></g></svg></a></div><div id="-codedoc-container" class="container"><script>window.source = {"base":"posts","path":"git-cleanup-unused-branches.md","namespace":"/blog","title":{"base":"uloco blog","connector":" | "}}</script><div class="hero-0-0-10" data-target="desktop" style="margin-bottom: -156px"><picture><source media="(min-width: 1025px)" srcset="https://images.unsplash.com/photo-1556075798-4825dfaaf498?w=1900&amp;h=600&amp;fit=crop"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" class="image-0-0-11" data-src="https://images.unsplash.com/photo-1556075798-4825dfaaf498?w=1900&amp;h=600&amp;fit=crop" data-hero=""></picture><span class="caption-0-0-12"></span></div><div class="hero-0-0-10" data-target="mobile" style="margin-bottom: -156px"><picture><source media="(max-width: 1024px)" srcset="https://images.unsplash.com/photo-1556075798-4825dfaaf498?w=1200&amp;h=600&amp;fit=crop"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" class="image-0-0-11" data-src="https://images.unsplash.com/photo-1556075798-4825dfaaf498?w=1200&amp;h=600&amp;fit=crop" data-hero=""></picture><span class="caption-0-0-12"></span></div><h1 class="h-0-0-13 white"><span style=" 
      text-shadow: 0 0 8px black; 
      font-size: 48px"><p>Git Cleanup Unused Branches</p></span></h1><script id="UWJftBSnLa">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("UWJftBSnLa", "R4YzEm+F30HSvtBlxprJqA==", {"src":"github"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><marker><br>

</marker><h2 id="the-workflow" class="heading-0-0-14"><span class="anchor-0-0-15" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>The Workflow</h2><p>A popular approach to work with git repositories is the so called <em>feature
branch strategy</em>. Here basically every developer on your team opens a branch
for a feature or bugfix they are working on locally and also on a remote
service like e.g. Github or Gitlab.</p><p>After a lot of commits and pushes you will have a working example of your
feature which gets reviewed by some of your peers most of the time and is
ready to be merged into main branch, where all code lives finally.</p><h2 id="the-problem" class="heading-0-0-14"><span class="anchor-0-0-15" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>The Problem</h2><p>As you can see this workflow leads to a lot of branches on your laptop and
also on the remote service, which need to be deleted once in a while. It's
way more convenient to have some local branches you are actually working on
and easily find them with <code>git branch</code> instead of having loads of
branches that you are already finished working with.</p><p>You can automatically delete the branches on your remote Github / Gitlab via
the browser interface once the branch is merged or setup some automation
rules, but locally there is no convenient way of doing that.</p><h2 id="the-solution" class="heading-0-0-14"><span class="anchor-0-0-15" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>The Solution</h2><p>Here is a simple bash script to delete all local branches, that are already
<strong>merged</strong> into your <em>main branch</em> and also <strong>deleted</strong> from your <em>remote
repository</em>.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-16" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="#!/usr/bin/env bash" id="code1-l1"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token shebang important">#!/usr/bin/env bash</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="" id="code1-l2"><span class="lineCounter-0-0-17 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="default_branch() {" id="code1-l3"><span class="lineCounter-0-0-17 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function-name function">default_branch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@'" id="code1-l4"><span class="lineCounter-0-0-17 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token function">git</span> symbolic-ref refs/remotes/origin/HEAD <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s@^refs/remotes/origin/@@'</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="}" id="code1-l5"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="" id="code1-l6"><span class="lineCounter-0-0-17 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="git fetch --all &amp;>/dev/null" id="code1-l7"><span class="lineCounter-0-0-17 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">git</span> fetch --all <span class="token operator">&amp;&gt;</span>/dev/null</div><br><div class="line-0-0-18  -codedoc-code-line" data-content="git checkout &quot;$(default_branch)&quot; &amp;>/dev/null" id="code1-l8"><span class="lineCounter-0-0-17 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">git</span> checkout <span class="token string">"<span class="token variable"><span class="token variable">$(</span>default_branch<span class="token variable">)</span></span>"</span> <span class="token operator">&amp;&gt;</span>/dev/null</div><br><div class="line-0-0-18  -codedoc-code-line" data-content="git remote prune origin" id="code1-l9"><span class="lineCounter-0-0-17 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">git</span> remote prune origin</div><br><div class="line-0-0-18  -codedoc-code-line" data-content="git branch -vv | grep &quot;origin/.*: gone]&quot; | awk &quot;{print \$1}&quot; | xargs git branch -d" id="code1-l10"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">git</span> branch -vv <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"origin/.*: gone]"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">"{print \<span class="token variable">$1</span>}"</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">git</span> branch -d</div><br></code></pre><div style="text-align: right"><button class="button-0-0-2 icon icon-font" onclick="smartCopy(this)">filter_none</button></div><p>To make this command look like a native git command, we can make use of a
neat little trick I found out about git commands in the shell. If you prefix
the script file with <code>git-</code>, so in this case for example
<code>git-cleanup-branches</code>, you can just run the script as any other git command.</p><p>You even get tab completion for that!</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-16" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="git cleanup-branches" id="code2-l1"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>git cleanup-branches</div><br></code></pre><p>You just need to make sure to add the file somewhere in your path.
I decided to make a dedicated directory just for custom scrips like these
and put them in <code>${HOME}/.local/bin</code>. Also you will have to make the script
runnable with <code>chmod</code> to make it work properly.</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-16" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="mkdir -p &quot;${HOME}/.local/bin&quot;" id="code3-l1"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>mkdir -p "${HOME}/.local/bin"</div><br><div class="line-0-0-18  -codedoc-code-line" data-content="touch &quot;${HOME}/.local/bin/git-cleanup-branches&quot;" id="code3-l2"><span class="lineCounter-0-0-17 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>touch "${HOME}/.local/bin/git-cleanup-branches"</div><br><div class="line-0-0-18  -codedoc-code-line" data-content="chmod u+x &quot;${HOME}/.local/bin/git-cleanup-branches&quot;" id="code3-l3"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>chmod u+x "${HOME}/.local/bin/git-cleanup-branches"</div><br></code></pre><div style="text-align: right"><button class="button-0-0-2 icon icon-font" onclick="smartCopy(this)">filter_none</button></div><p>Now you just need to copy and paste the script from above into
<code>"${HOME}/.local/bin/git-cleanup-branches"</code> and add the following lines to
your shell <code>rc</code> file, like <code>.bash_profile</code>, <code>.bashrc</code>, or <code>.zshrc</code> (whatever
you are using), which are usually located in your home directory.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-16" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="# Add local binaries to path" id="code4-l1"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment"># Add local binaries to path</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="export PATH=&quot;${PATH}:${HOME}/.local/bin&quot;" id="code4-l2"><span class="lineCounter-0-0-17 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">${<span class="token environment constant">PATH</span>}</span>:<span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.local/bin"</span></div><br></code></pre><div style="text-align: right"><button class="button-0-0-2 icon icon-font" onclick="smartCopy(this)">filter_none</button></div><p>Now just open a new terminal and the command should work fine.</p><p>Done, happy cleaning! 😊</p><h3 id="sidenote" class="heading-0-0-14"><span class="anchor-0-0-15" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Sidenote</h3><p>Take note, that not fully merged branches won't be deleted and need to be
deleted manually <em>only</em> if you are sure about it.</p><p>You can do this with <code>git branch -D &lt;branchname&gt;</code>.</p><p><strong>Please only do this, if you know what you are doing, or progress could be lost!</strong></p><hr><div class="darklight-0-0-1"><div class="dark"><p><em>Hero image by <a href="https://unsplash.com/@yancymin">Yancy Min</a> from <a href="https://unsplash.com">Unsplash</a></em></p></div><div class="light"><p><em>Hero image by <a href="https://unsplash.com/@yancymin">Yancy Min</a> from <a href="https://unsplash.com">Unsplash</a></em></p></div></div><div class="contentnav-0-0-9" data-no-search=""><a href="#the-workflow" class="h2" data-content-highlight="the-workflow">The Workflow</a><a href="#the-problem" class="h2" data-content-highlight="the-problem">The Problem</a><a href="#the-solution" class="h2" data-content-highlight="the-solution">The Solution</a><a href="#sidenote" class="h3" data-content-highlight="sidenote">Sidenote</a></div></div><div id="-codedoc-toc" class="toc-0-0-6"><div class="content-0-0-7"><p><a href="/blog/">Home</a>
<a href="/blog/git-cleanup-unused-branches">Git Cleanup Unused Branches</a></p></div></div><div class="footer-0-0-5"><div class="left"><script id="yNefLuFWaW">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("yNefLuFWaW", "9QmaulaXBcDH7F6NpY63wQ==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="oZPFoGrSVx">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("oZPFoGrSVx", "tFISVdvLy/7dJdr4XZdc9Q==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="QDhlAHQYTw">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("QDhlAHQYTw", "Ww783Fpk/T0QF/oA+qje8g==", {"namespace":"/blog"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>